<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
<style>
	#console{
		border: 1px solid red;
		min-width: 200px;
		min-height: 200px
	}
</style>
</head>
<body>
	<div id="console"></div>
</body>
<script>
var lastXY = {};

function DoEvent(eventObject) {

	// stop panning and zooming so we can draw
	if(eventObject.preventManipulation) eventObject.preventManipulation();

	// we are handling this event
	if(eventObject.preventDefault) eventObject.preventDefault();

	// if we have an array of changedTouches, use it, else create an array of one with our eventObject
	var touchPoints = (typeof eventObject.changedTouches != 'undefined') ? eventObject.changedTouches : [eventObject];
	for(var i = 0; i < touchPoints.length; ++i) {
		var touchPoint = touchPoints[i];
		// pick up the unique touchPoint id if we have one or use 1 as the default
		var touchPointId = (typeof touchPoint.identifier != 'undefined') ? touchPoint.identifier : (typeof touchPoint.pointerId != 'undefined') ? touchPoint.pointerId : 1;

		if(eventObject.type.match(/(down|start)$/i)) {
			// process mousedown, MSPointerDown, and touchstart
			lastXY[touchPointId] = {
				x: touchPoint.pageX,
				y: touchPoint.pageY
			};
			condiv.innerHTML=" 进入start"+touchPointId+","+touchPoint.pageX+","+touchPoint.pageY;
		} else if(eventObject.type.match(/move$/i)) {
			// process mousemove, MSPointerMove, and touchmove
			if(lastXY[touchPointId] && !(lastXY[touchPointId].x == touchPoint.pageX && lastXY[touchPointId].y == touchPoint.pageY)) {
				lastXY[touchPointId] = {
					x: touchPoint.pageX,
					y: touchPoint.pageY
				};
				condiv.innerHTML=" 进入Move"+touchPointId+","+touchPoint.pageX+","+touchPoint.pageY;
			}
		} else if(eventObject.type.match(/(up|end)$/i)) {
			// process mouseup, MSPointerUp, and touchend
			condiv.innerHTML=" 进入end"+touchPointId+","+touchPoint.pageX+","+touchPoint.pageY;
		}
	}
}

var condiv = document.getElementById('console');
condiv.innerHTML="准备完成";
ev(condiv);
function ev(target) {
	if(window.navigator.msPointerEnabled) {
		console.log("ie")
		condiv.innerHTML+="进入ie";
		// Microsoft pointer model
		target.addEventListener("MSPointerDown", DoEvent, false);
		target.addEventListener("MSPointerMove", DoEvent, false);
		target.addEventListener("MSPointerUp", DoEvent, false);
		target.addEventListener("MSPointerCancel", DoEvent, false);

		// css way to prevent panning in our target area
		if(typeof target.style.msContentZooming != 'undefined') target.style.msContentZooming = "none";

		// new in Windows Consumer Preview: css way to prevent all built-in touch actions on our target
		// without this, you cannot touch draw on the element because IE will intercept the touch events
		if(typeof target.style.msTouchAction != 'undefined') target.style.msTouchAction = "none";

	}
	else if(target.addEventListener) {
		console.log("主流")
		condiv.innerHTML+="进入主流";
		// iOS touch model
		target.addEventListener("touchstart", DoEvent, false);
		target.addEventListener("touchmove", DoEvent, false);
		target.addEventListener("touchend", DoEvent, false);
		target.addEventListener("touchcancel", DoEvent, false);

		

		// mouse model with capture
		// rejecting gecko because, unlike ie, firefox does not send events to target when the mouse is outside target
		if(target.setCapture && !window.navigator.userAgent.match(/\bGecko\b/)) {
			useSetReleaseCapture = true;
			// mouse model
			target.addEventListener("mousedown", DoEvent, false);
			target.addEventListener("mousemove", DoEvent, false);
			target.addEventListener("mouseup", DoEvent, false);
		}
	}
}
</script>
</html>